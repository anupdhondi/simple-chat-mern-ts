(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{66:function(e,t,n){},73:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(8),s=n.n(c),i=(n(66),n(25)),o=n(11),l=n(54),u=n(19),j=n(104),d=n(108),h=n(112),b=n(109),p=n(42),O=n(111),f=n(110),g=n(4);var m=window.location.hostname+":8080";function x(){var e=Object(a.useState)(""),t=Object(u.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)([]),i=Object(u.a)(s,2),x=i[0],v=i[1],y=Object(a.useState)(null),w=Object(u.a)(y,2),S=w[0],k=w[1],C=Object(o.f)();return Object(a.useEffect)((function(){var e=new WebSocket("ws://".concat(m,"/")+localStorage.getItem("token"));return e.addEventListener("open",(function(){e.send(JSON.stringify({intent:"old-messages",count:10}))}),{once:!0}),e.addEventListener("error",(function(){alert("Please login first"),C.replace("/login")})),e.addEventListener("message",(function(e){var t=function(e){try{return JSON.parse(e)}catch(t){return null}}(e.data);t&&("chat"===t.intent?v((function(e){return[].concat(Object(l.a)(e),[t])})):"old-messages"===t.intent&&(console.log(t.data,"are the older messages"),v(t.data.map((function(e){return{user:e.email,message:e.message}})).reverse())))})),k(e),function(){e.close()}}),[C]),Object(g.jsxs)("div",{children:[Object(g.jsx)("h1",{children:"Chat Page"}),Object(g.jsx)("div",{className:"chat-box",children:x.map((function(e,t){return Object(g.jsxs)(j.a,{alignItems:"flex-start",children:[Object(g.jsx)(d.a,{children:Object(g.jsx)(h.a,{alt:"Remy Sharp",src:"/static/images/avatar/1.jpg"})}),Object(g.jsx)(b.a,{primary:e.user,secondary:Object(g.jsx)(r.a.Fragment,{children:Object(g.jsx)(p.a,{component:"span",variant:"body2",color:"textPrimary",children:e.message})})})]},t)}))}),Object(g.jsx)(O.a,{onChange:function(e){return c(e.target.value)},value:n,multiline:!0,rows:2,variant:"outlined",color:"primary"}),Object(g.jsx)(f.a,{variant:"outlined",color:"primary",onClick:function(){(null===S||void 0===S?void 0:S.readyState)===WebSocket.OPEN&&(S.send(JSON.stringify({message:n,intent:"chat"})),c(""))},children:"Send Message"})]})}n(73);function v(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsxs)("header",{className:"App-header",children:[Object(g.jsx)("h1",{children:"Simple Chat App"}),Object(g.jsxs)("div",{className:"buttons",children:[Object(g.jsx)(f.a,{color:"secondary",variant:"contained",component:i.b,to:"/login",children:"Login"}),Object(g.jsx)(f.a,{color:"primary",variant:"contained",component:i.b,to:"/register",children:"Register"})]})]})})}var y=n(21),w=n.n(y),S=n(27),k=(n(75),!("localhost"===window.location.hostname)?"":"http://localhost:5000");function C(e,t){return N.apply(this,arguments)}function N(){return(N=Object(S.a)(w.a.mark((function e(t,n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(k).concat(t),{method:"POST",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("token")||""},body:JSON.stringify(n)}).then((function(e){return e.json()}));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){var e=Object(a.useState)(""),t=Object(u.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),s=Object(u.a)(c,2),i=s[0],l=s[1],j=Object(o.f)();function d(){return(d=Object(S.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/api/login",{email:n,password:i});case 2:"ok"===(t=e.sent).status?(localStorage.setItem("token",t.data),alert("You are logged in"),j.push("/chat")):alert(t.error);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(g.jsxs)("div",{className:"form",children:[Object(g.jsx)("h1",{children:"Login"}),Object(g.jsxs)("form",{className:"register-fields",children:[Object(g.jsx)(O.a,{fullWidth:!0,placeholder:"you@awesome.com",label:"Your Email",value:n,onChange:function(e){return r(e.target.value)},variant:"outlined"}),Object(g.jsx)(O.a,{fullWidth:!0,value:i,onChange:function(e){return l(e.target.value)},placeholder:"p@$$w0rd",label:"Password",variant:"outlined"}),Object(g.jsx)(f.a,{color:"primary",variant:"contained",onClick:function(){return d.apply(this,arguments)},children:"Login"})]})]})}n(76);function E(){var e=Object(a.useState)(""),t=Object(u.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),s=Object(u.a)(c,2),i=s[0],o=s[1];function l(){return(l=Object(S.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C("/api/register",{email:n,password:i});case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(g.jsxs)("div",{className:"form",children:[Object(g.jsx)("h1",{children:"Register"}),Object(g.jsxs)("form",{className:"register-fields",children:[Object(g.jsx)(O.a,{fullWidth:!0,placeholder:"you@awesome.com",label:"Your Email",value:n,onChange:function(e){return r(e.target.value)},variant:"outlined"}),Object(g.jsx)(O.a,{fullWidth:!0,value:i,onChange:function(e){return o(e.target.value)},placeholder:"p@$$w0rd",label:"Password",variant:"outlined"}),Object(g.jsx)(f.a,{color:"primary",variant:"contained",onClick:function(){return l.apply(this,arguments)},children:"Register"})]})]})}var L=function(){return Object(g.jsx)(i.a,{children:Object(g.jsxs)(o.c,{children:[Object(g.jsx)(o.a,{path:"/",exact:!0,children:Object(g.jsx)(v,{})}),Object(g.jsx)(o.a,{path:"/login",exact:!0,children:Object(g.jsx)(P,{})}),Object(g.jsx)(o.a,{path:"/register",exact:!0,children:Object(g.jsx)(E,{})}),Object(g.jsx)(o.a,{path:"/chat",exact:!0,children:Object(g.jsx)(x,{})})]})})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,114)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))};s.a.render(Object(g.jsx)(r.a.StrictMode,{children:Object(g.jsx)(L,{})}),document.getElementById("root")),I()}},[[77,1,2]]]);
//# sourceMappingURL=main.ae445494.chunk.js.map